<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PS5 Offset Finder</title>
  <style>
    body{font-family:monospace;max-width:800px;margin:2em auto}
    textarea{width:100%;height:300px}
  </style>
</head>
<body>
  <h1>PS5 Offset Finder (JS)</h1>
  <label for="refFile">Reference binary (e.g. WebKit or kernel reference):</label><br>
  <input type="file" id="refFile" accept="*/*"><br><br>
  <label for="tgtFile">Target binary (new firmware dump):</label><br>
  <input type="file" id="tgtFile"><br>
  <label>Pattern length:<input id="len" type="number" value="32" min="8" max="128"></label><br>
  <button onclick="run()">Find Offsets</button>
  <textarea id="out"></textarea>
  <script>
    const REFS = {
      OFFSET_wk_vtable_first_element: 0x00269B70,
      OFFSET_wk_memset_import: 0x028D8DB0,
      OFFSET_wk___stack_chk_guard_import: 0x028D8A90,
      OFFSET_lk___stack_chk_guard: 0x0006D1D0,
      OFFSET_lk_pthread_create_name_np: 0x00001C40,
      OFFSET_lk_pthread_join: 0x000310A0,
      OFFSET_lk_pthread_exit: 0x00021560,
      OFFSET_lk__thread_list: 0x00064208,
      OFFSET_lk_sleep: 0x00024920,
      OFFSET_lk_sceKernelGetCurrentCpu: 0x00002770,
      OFFSET_lc_memset: 0x00014D70,
      OFFSET_lc_setjmp: 0x0005B420,
      OFFSET_lc_longjmp: 0x0005B470,
      OFFSET_WORKER_STACK_OFFSET: 0x0007FB88,
      GADGET_RET: 0x00000042,
      "pop rdi": 0x000A9D2E,
      "pop rsi": 0x000463CC,
      "pop rdx": 0x000F3571,
      "pop rcx": 0x000016C2,
      "pop r8": 0x00F537AF,
      "pop r9": 0x00142136,
      "pop rax": 0x0004D430,
      "pop rsp": 0x001C9BB4,
      "mov [rdi], rsi": 0x0036BF40,
      "mov [rdi], rax": 0x000D2987,
      "mov [rdi], eax": 0x000004D4,
      infloop: 0x000172C1,
      "shl rax, 4": 0x013AD166,
      "cmp [rcx], eax": 0x00690582,
      "sete al": 0x0001C273,
      "seta al": 0x001F369A,
      "setb al": 0x00041161,
      "setg al": 0x001F36CE,
      "setl al": 0x007C140C,
      "shl rax, 3": 0x019B1DE3,
      "add rax, rcx": 0x000DA1CE,
      "mov rax, [rax]": 0x000B465C,
      "inc dword [rax]": 0x00044BDA
    };
    const SYC = {1:0x00034F5A,3:0x00034B20,29:0x00035F80};
    function find(buf,pat){
      const d=new Uint8Array(buf),p=new Uint8Array(pat),res=[];
      for(let i=0;i+p.length<=d.length;i++){
        let ok=true;for(let j=0;j<p.length;j++)if(d[i+j]!=p[j]){ok=false;break}
        ok&&res.push(i);
      }
      return res;
    }
    async function run(){
      const ref=await document.getElementById('refFile').files[0].arrayBuffer();
      const tgt=await document.getElementById('tgtFile').files[0].arrayBuffer();
      const L=+document.getElementById('len').value;
      let o="Pattern length: "+L+"\n";
      for(let k in REFS){
        const off=REFS[k]; const pat=ref.slice(off,off+L);
        const m=find(tgt,pat);
        o+=m.length?`const ${k}=0x${m[0].toString(16)};\n`:`// ${k} not found\n`;
      }
      o+="\nSyscalls:\n";
      for(let k in SYC){
        const off=SYC[k];const pat=ref.slice(off,off+8);
        const m=find(tgt,pat);
        o+=m.length?`// syscall ${k}=0x${m[0].toString(16)}\n`:`// sys ${k} not found\n`;
      }
      document.getElementById('out').value=o;
    }
  </script>
</body>
</html>
